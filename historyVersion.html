<html>
<meta charset="utf-8">
<title>历史版本</title>
</head>

<body onload="getAllTemplelists()">
    <script type="text/javascript" src='js/main.js'></script>
    <select id="templates" size=5 style='width:360px'>
        <!--这里ajax动态拉取。-->
    </select>
    <br />
    <br />
    <button type="button" onClick="selectTemplate()">打开</button>
</body>

</html>

<script>

function selectTemplate() {
    var yozoApp = yozo.WApplication();
    var obj = document.getElementById("templates");
    var index = obj.selectedIndex;
    if (index == -1) { //添加未选中数据时的异常处理
        alert("请先选择红头文件后再进行套红头！");
        return;
    }
    var redId = obj.options[index].getAttribute("value");
    var hongtaoUrl;
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open("get", "http://39.100.72.227:9999/yz6/OASoft/pull/getBanbens", true); //以POST方式请求该接口
    xmlhttp.setRequestHeader("Content-type",
        "application/x-www-form-urlencoded;charset=UTF-16LE"); //添加Content-type
    xmlhttp.send(); //发送请求参数间用&分割
    xmlhttp.onreadystatechange = function () {
        //当接受到响应时回调该方法
        if (xmlhttp.readyState == 4 && (xmlhttp.status == 200 || xmlhttp.status == 0)) {
            var text = xmlhttp.responseText; //使用接口返回内容，响应内容
            hongtaoUrl = text;

          
            yozoApp.openDocumentRemote(hongtaoUrl,false);
           

        }
    }

    window.opener = null;
    window.open('', '_self', '');
    window.close();
}

function getAllTemplelists() {
    var doc = yozo.WApplication().getActiveDocument();
         var templateDataUrl = getDocParamsValue(doc, "historyPath");
         //templateDataUrl = "http://39.100.72.227:9999/yz6/OASoft/pull/getBanben";
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function () {
        //当接受到响应时回调该方法
        if (xmlhttp.readyState == 4 && (xmlhttp.status == 200 || xmlhttp.status == 0)) {
            var text = xmlhttp.responseText; //使用接口返回内容，响应内容
            var resultArr = [];
            resultArr = eval("("+text+")"); ;
            for (var i = 0; i < resultArr.length; i++) {
                var element = resultArr[i]
                var myOption = document.createElement("option"); //动态创建option标签
               var suffix = element[2].split(".")[1]
             
                    myOption.value = element[0]; //红头文档id
                    myOption.text = element[1]; //红头文档名称
                   // myOption.text = element[2]; //红头文档名称
                    templates.add(myOption);
           
            }
            console.log("text==",text)
        }
    }


    xmlhttp.open("GET", templateDataUrl, true); //以POST方式请求该接口
    xmlhttp.setRequestHeader("Content-type",
        "application/x-www-form-urlencoded;charset=UTF-16LE"); //添加Content-type
    xmlhttp.send(); //发送请求参数间用&分割
  
}


</script>